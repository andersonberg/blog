<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8">
  <title>Posts com django | Anderson Berg</title>

  <meta name="author" content="Anderson Berg">
  <meta name="description" content="Posts com django">
  <meta name="robots" content="noindex,follow">

  <meta property="og:site_name" content="Anderson Berg">
  <meta property="og:type" content="website">
    <meta property="og:image" content="../opengraph.jpg">



  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="icon" type="image/x-icon" href="../favicon.ico">

  <link rel="alternate" type="application/rss+xml" title="Anderson Berg &raquo; Feed" href="/">
  <link rel="canonical" href="../tag/django.html">

    <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.0/build/pure-min.css" integrity="sha384-nn4HPE8lTHyVtfCBi5yW9d20FjT8BJwUXyWZT9InLYax14RDjBj46LmSztkmNP9w" crossorigin="anonymous">
      <link rel="stylesheet" href="../theme/css/styles.min.css?0830b1e2">
</head>
<body>
  <div class="Page pure-g ">
<div class="PageHeader pure-u-1">
    <nav class="pure-menu pure-menu-open pure-menu-horizontal">

        <a
			href="../index.html"
            title="Home page"
            class="PageHeader-link pure-menu-heading pure-menu-link">Anderson<span class="u-highlighted">Berg</a>

			<ul class="PageHeader-menu pure-menu-list">
                    <li class="pure-menu-item">
                        <a href="../pages/contato.html" class="PageHeader-menu-link pure-menu-link">Contato</a>
                    </li>

			</ul>
    </nav>
</div>
    <div class="PageContent pure-u-1">
<h1 class="Tag-title u-box">Posts com django</h1>

    

<article class="Article u-box" itemscope="" itemtype="http://schema.org/BlogPosting">
    <span itemprop="mainEntityOfPage">
        <header>
            <h1 class="Article-title" itemprop="headline name">
                    <a
                        class="Article-titleLink"
                        href="../como-criar-um-blog-com-django.html"
                        title="Leia mais">
                Como Criar um Blog de Forma Simples e Rápida com Django
                    </a>
            </h1>

        </header>

        <div class="Article-content" itemprop="articleBody">
<img
        src="images/blog_on.jpg"
        alt="None"
        class="representative-image"
        width="180"
        height="180" />
                <p>Você quer criar um blog pra espalhar suas ideias na rede?</p>
<p>Quer fazer isso em <strong>poucos passos</strong> usando <strong>Django</strong>?</p>
<p>Nas últimas semanas fizemos algumas mudanças no Pythonize e agora o blog está totalmente em <strong>Django</strong>! Já era uma coisa que eu planejava fazer, afinal um blog que fala sobre Python é bom que seja feito com Python.</p>
<p>Neste post vou contar um pouco como foi a experiência de criar um blog em Django usando o <strong>Mezzanine</strong>, um CMS muito poderoso que já vem com um admin pronto para blogs.</p>
<p><strong>Continue lendo este artigo</strong> para aprender, com detalhes, como instalar o Mezzanine, criar um projeto, configurar e aplicar um tema. No final, ainda vou dar uma dica bônus.</p>
<p>Também fizemos a migração do servidor para o <a href="https://www.digitalocean.com/?refcode=c831ddc18699">DigitalOcean</a>. Se você ainda não tem um servidor, recomendo o DigitalOcean e clicando <a href="https://www.digitalocean.com/?refcode=c831ddc18699">neste link</a> para fazer o cadastro, você ajuda a pagar uma parte da conta do Pythonize :)</p>
<h2>Instalando o Mezzanine</h2>
<p>O Mezzanine vem com diversas features bem úteis como integração com <strong>Analytics</strong>, <strong>Disqus</strong> e <strong>Gravatar</strong>. A lista completa você pode ver em: http://mezzanine.jupo.org/docs/overview.html#features</p>
<p>A instalação do Mezzanine é bem simples, vamos começar criando um ambiente virtual.</p>
<h3>Criando um ambiente virtual</h3>
<p>Antes de tudo é sempre recomendável instalar o virtualenv, pra não poluir o seu ambiente. O virtualenv é uma ferramenta que cria um ambiente Python separado do seu sistema, evitando maiores dores de cabeça com configurações.</p>
<p>Para criar um ambiente virtual é bem simples, basta passar o comando virtualenv seguido do diretório onde vai ser armazenado o ambiente, por exemplo:</p>
<div class="highlight"><pre><span></span><code>$ virtualenv venv
</code></pre></div>


<p>No Windows você precisa fazer:</p>
<div class="highlight"><pre><span></span><code><span class="err">&gt; \path\to\env\Scripts\activate</span>
</code></pre></div>


<h3>Instalando o Mezzanine e as dependências</h3>
<p>Com o ambiente virtual ativado, você pode usar o pip para instalar o Mezzanine e todas as dependências necessárias:</p>
<div class="highlight"><pre><span></span><code>$ pip install mezzanine
</code></pre></div>


<p>Pronto, o pip se encarrega de instalar todas as dependências e o próprio Mezzanine. No final, você já estará pronto para criar seu primeiro projeto com o Mezzanine.</p>
<h2>Usando o Mezzanine</h2>
<p>O Mezzanine funciona de uma forma muito parecida do Django. Para criar um novo projeto Mezzanine, faça de forma semelhante a criar um projeto Django:</p>
<div class="highlight"><pre><span></span><code>$ mezzanine-project meu_blog
</code></pre></div>


<p>Simples né?
Agora o Mezzanine já criou toda a estrutura do projeto, igualzinho como o Django faz:</p>
<h3>Criando um banco de dados</h3>
<p>O Mezzanine vem com algumas ferramentas além das que já conhecemos do Django. Para criar e iniciar um banco de dados basta você rodar o seguinte comando:</p>
<div class="highlight"><pre><span></span><code><span class="err">python manage.py createdb</span>
</code></pre></div>


<p>Quando você rodar este comando vão aparecer algumas perguntas que você pode responder facilmente.</p>
<h3>Editando as configurações</h3>
<p>Agora, antes de começar a testar é hora de você mexer nas configurações da sua aplicação. Abra o arquivo settings.py na raiz do seu projeto e procure a seguinte linha:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="n">ALLOWED_HOSTS</span> <span class="o">=</span> <span class="p">[]</span>
</code></pre></div>
</td></tr></table>

<p>E troque pelo seguinte:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="n">ALLOWED_HOSTS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;.example.com&#39;</span><span class="p">,</span> <span class="c1"># Allow domain and subdomains</span>
    <span class="s1">&#39;.example.com.&#39;</span><span class="p">,</span> <span class="c1"># Also allow FQDN and subdomains</span>
<span class="p">]</span>
</code></pre></div>
</td></tr></table>

<p>Esta é uma lista de strings que representam os hosts e domínios que seu site Django pode servir. Lembre-se de trocas 'example.com' pelo nome do seu domínio.</p>
<p>Busque também pela linha:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="n">TIME_ZONE</span> <span class="o">=</span>
</code></pre></div>
</td></tr></table>

<p>E substitua pelo seu fuso horário, por exemplo:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="n">TIME_ZONE</span> <span class="o">=</span> <span class="s1">&#39;America/Recife&#39;</span>
</code></pre></div>
</td></tr></table>

<h3>Testando seu site</h3>
<p>Para ver como está o seu blog até agora, execute o seguinte na linha de comando (com o ambiente virtual ativado):</p>
<div class="highlight"><pre><span></span><code><span class="err">python manage.py runserver</span>
</code></pre></div>


<p>Você pode ver seu site acessando o endereço http://127.0.0.1:8000/ no seu browser. Para terminar o servidor, pressione CTRL+C.</p>
<h3>Escreva novos artigos</h3>
<p>Você tem acesso à tela de administração indo até: http://127.0.0.1:8000/admin/ e digitando usuário e senha que você criou quando executou o comando para criação do banco de dados.</p>
<p>Lá você terá acesso ao dashboard do Mezzanine, onde é possível escrever artigos, gerenciar arquivos de mídia, criar novas páginas pro site e outras coisas.</p>
<h3>Aplicando um tema</h3>
<p>Um site não é nada sem um bom layout. Até agora, só cuidamos do back-end do blog, precisamos então dar uma cara pra ele.</p>
<p>O Mezzanine já tem temas prontos para serem usados e que se integram à ferramenta, todos baseados no bootstrap. Você pode optar por <a href="http://thecodinghouse.in/themes/">temas gratuitos</a> ou <a href="http://mezzathe.me/">temas premium pagos</a>.</p>
<p>Escolha um dos temas gratuitos e faça o download. O tema é um app Django, então basta copiar dentro do projeto Mezzanine e adicionar ao INSTALLED_APPS no arquivo settings.py. É recomendável que seja o primeiro app na lista.</p>
<p>Pronto, seu blog está totalmente configurado e com um belo template, agora é só criar conteúdo para seus leitores.</p>
<h2>Bônus: Como migrar seu site Wordpress para Mezzanine</h2>
<p>Com o Mezzanine é possível importar artigos de outras plataformas de blog como Wordpress e Blogger.</p>
<p>Para fazer a importação dos seus artigos do Wordpress, primeiro é preciso instalar o <a href="https://code.google.com/p/feedparser/">feedparser</a>, que pode ser instalar via pip.</p>
<div class="highlight"><pre><span></span><code><span class="err">pip install feedparser</span>
</code></pre></div>


<p>Faça login no seu blog Wordpress e vá em Ferramentas -&gt; Exportar. Nesta tela você pode configurar alguns filtros e realizar a exportação do arquivo. Lembre-se de guardar o caminho onde o arquivo foi baixado.</p>
<p>O comando pra importar os artigos do Wordpress só funciona com o Python 2. Quando criar o ambiente virtual é importante informar ao virtualenv qual é a versão do Python que você deseja utilizar, por exemplo, no Linux:</p>
<div class="highlight"><pre><span></span><code><span class="err">virtualenv -p /usr/bin/python2.7 venv</span>
</code></pre></div>


<p>Por último, simplesmente execute o comando import_wordpress, passando o seu usuário no mezzanine e o caminho onde está o arquivo no argumento 'url':</p>
<div class="highlight"><pre><span></span><code><span class="n">python</span><span class="w"> </span><span class="n">manage</span><span class="p">.</span><span class="n">py</span><span class="w"> </span><span class="n">import_wordpress</span><span class="w"> </span><span class="c1">--mezzanine-user=.. --url=[caminho_do_arquivo]</span>
</code></pre></div>


<h3>Concluindo</h3>
<p>Foi muito gratificante finalmente conseguir migrar o Pythonize pra Django. E o Mezzanine facilitou bastante esse trabalho. Agora é muito mais fácil pra mim gerenciar o site e fazer modificações, pois está tudo em Python e não em PHP como no Wordpress.</p>
<p>Consegui integrar com todas as ferramentas que utilizava antes no Wordpress, principalmente Analytics e Disqus, tudo foi muito simples.</p>
<p>Agora tenho uma pergunta para você</p>
<p>O que você achou de trabalhar com Django e Mezzanine para criar um blog?</p>
<p>Deixe seu comentário logo abaixo!</p>
<p>Imagem por: <a href="http://www.flickr.com/photos/futureshape/4977096245/">futureshape</a></p>
        </div>
    </span>

</article>
<article class="Article u-box" itemscope="" itemtype="http://schema.org/BlogPosting">
    <span itemprop="mainEntityOfPage">
        <header>
            <h1 class="Article-title" itemprop="headline name">
                    <a
                        class="Article-titleLink"
                        href="../criar-api-rest-django.html"
                        title="Leia mais">
                Como criar uma API REST com Django
                    </a>
            </h1>

        </header>

        <div class="Article-content" itemprop="articleBody">
<img
        src="images/cloud-1.png"
        alt="None"
        class="representative-image"
        width="180"
        height="180" />
                <p>Como construir uma  <strong>API Restful</strong>  totalmente  <strong>configurável</strong> ,  <strong>funcional</strong>  e  <strong>simples</strong> ?</p>
<p>Como tornar essa API <strong>pública</strong>, ao mesmo tempo que <strong>protege</strong> seus dados?</p>
<p>E como fazer tudo isso usando <strong>Django</strong>?</p>
<p>Você vai conhecerum pouco do <strong>Tastypie</strong>, um framework Python muito eficiente que provê uma <a href="http://pt.wikipedia.org/wiki/API">API</a> (Application Programming Interface, em português: Interface de Programação de Aplicativos) <a href="http://pt.wikipedia.org/wiki/REST">REST</a> totalmente configurável para trabalhar com Django.</p>
<p>Para acompanharo que vamos apresentar aqui, <strong>não</strong> é necessário ser expert emDjango. Vamos seguir um <strong>passo-a-passo</strong> bem simples. Se você já sabe como configurar e usar o Django, pode pular para a parte de configuração do Tastypie, ou utilizar este tutorial como lembrete.</p>
<p>Se você quer se aprofundar no estudo de Djangorecomendo os seguintes links: <a href="https://docs.djangoproject.com/en/1.6/intro/tutorial01/">Django Tutorial</a>, <a href="http://www.tangowithdjango.com/book/">Tango with Django</a>.</p>
<p>E para aprender mais sobre RESTful webservices, tem um tutorial bem interessante <a href="http://www.restapitutorial.com/">aqui</a>.</p>
<h2>Como Funciona o Tastypie</h2>
<p>O Tastypie ajuda você a publicar os models criados no Django, ao mesmo tempo que permite total controle sobre que é exibido ou não. O Tastypie <strong>serializa</strong> a saída em diversos formatos, incluindo json. Através da criação de objetos 'Resource', o Tastypie implementa formas de obter dados (GET), criar (POST) e modificar (PUT/PATCH) dados e excluir dados (DELETE).</p>
<p>Com estas dicas, você irá construir uma pequena API pra um exemplo de <strong>microblog</strong>, como o Twitter.</p>
<h2>Configurando o ambiente de desenvolvimento</h2>
<p>Antes de tudo e qualquer coisa, pra não bagunçar o seu ambiente, instale o <a href="https://virtualenv.pypa.io/en/latest/">virtualenv</a>. O virtualenv é uma ferramenta que cria um ambiente Python <strong>separado</strong> do seu sistema, evitando maiores dores de cabeça com configurações.</p>
<p>Para criar um ambiente virtual é bem simples, basta passar o comando virtualenv seguido do diretório onde vai ser armazenado o ambiente, por exemplo:</p>
<div class="highlight"><pre><span></span><code>$ virtualenv venv
</code></pre></div>


<p>Pronto, seu ambiente virtual foi instalado na pasta 'venv'. Agora, pra começar a usar é preciso ativar o ambiente:</p>
<div class="highlight"><pre><span></span><code>$ <span class="nb">source</span> venv/bin/activate
</code></pre></div>


<p>Você pode perceber que o contexto da sua linha de comando mudou, quer dizer que o ambiente está pronto pra ser usado.</p>
<h2>Instalação do Tastypie</h2>
<p>Com o ambiente ativado, agora é a hora de instalar o django, em seguida instale algumas dependências do tastypie e ele próprio:</p>
<div class="highlight"><pre><span></span><code>$ pip install django
$ pip install python-mimeparse lxml defusedxml
$ pip install django-tastypie
</code></pre></div>


<p>Pra maiores detalhes de instalação e configuração, você pode olhar na <a href="http://django-tastypie.readthedocs.org/en/latest/tutorial.html">documentação</a> do Tastypie.</p>
<h2>Criando um projeto Django</h2>
<p>Com tudo instalado, criar um projeto django e uma aplicação dentro do projeto também é bem fácil:</p>
<div class="highlight"><pre><span></span><code>$ django-admin.py startproject webserver
$ <span class="nb">cd</span> webserver/webserver
$ python ../manage.py startapp rest_app
</code></pre></div>


<h2>Configurando o banco de dados</h2>
<p>Vamos utilizar como banco de dados o Sqlite, verifique se no seu arquivo settings.py já está habilitado:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="n">DATABASES</span> <span class="o">=</span> <span class="p">{</span>
<span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">&#39;ENGINE&#39;</span><span class="p">:</span> <span class="s1">&#39;django.db.backends.sqlite3&#39;</span><span class="p">,</span>
    <span class="s1">&#39;NAME&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s1">&#39;db.sqlite3&#39;</span><span class="p">),</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
</td></tr></table>

<p>Crie o banco de dados inicial para o Django:</p>
<div class="highlight"><pre><span></span><code>$ python manage.py syncdb
</code></pre></div>


<h3>Testando tudo até aqui</h3>
<p>Pra testar tudo até aqui, você pode iniciar o servidor:</p>
<div class="highlight"><pre><span></span><code>$ python manage.py runserver
</code></pre></div>


<p>E acessar através da url: http://localhost:8000</p>
<h3>pip freeze</h3>
<p>O pip tem um comando que cria um registro dos pacotes que foram instalados no ambiente. Isso é útil se você quiser recriar o projeto e ter todos os pacotes nas versões necessárias.</p>
<div class="highlight"><pre><span></span><code>$ pip freeze &gt; requirements.txt
</code></pre></div>


<h2>Criando a API</h2>
<h3>Criando uma nova aplicação</h3>
<p>Você cria um nova aplicação com o comando startapp:</p>
<div class="highlight"><pre><span></span><code><span class="err">$python manage.py startapp rest_app</span>
</code></pre></div>


<p>Lembre-se de atualizar o INSTALLED_APPS no seu arquivo settings.py com a aplicação criada.</p>
<h3>Configuração inicial do Tastypie</h3>
<p>O primeiro passo é adicionar 'tastypie' em INSTALLED_APPS no arquivo settings.py do seu projeto Django. A documentação do Tastypie diz que essa é a única configuração obrigatória. Para nosso exemplo vai ser suficiente por enquanto.</p>
<p>Eu tive que fazer uma modificação no settings.py por causa de um problema com autenticação. Não sei se será seu caso, só tive que remover uma linha do MIDDLEWARE_CLASSES:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="n">MIDDLEWARE_CLASSES</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s1">&#39;django.contrib.sessions.middleware.SessionMiddleware&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.middleware.common.CommonMiddleware&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.middleware.csrf.CsrfViewMiddleware&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.auth.middleware.AuthenticationMiddleware&#39;</span><span class="p">,</span>
    <span class="c1">#&#39;django.contrib.auth.middleware.SessionAuthenticationMiddleware&#39;,</span>
    <span class="s1">&#39;django.contrib.messages.middleware.MessageMiddleware&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.middleware.clickjacking.XFrameOptionsMiddleware&#39;</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>
</td></tr></table>

<h3>Criando seus models</h3>
<p>O <a href="https://docs.djangoproject.com/en/dev/topics/db/models/">model</a> é onde você armazena as informações básicas dos seus dados. Cada model é uma classe Python que herda de django.db.models.Model e que se torna uma tabela no seu banco de dados. Vamos criar alguns models para nossa aplicação.</p>
<p>Você só precisa criar um model para a nossa aplicação que é a classe que vai conter um post no microblog. A classe de usuário podemos obter do próprio Django.</p>
<p>Então, edite o seu arquivo models.py e adicione a seguinte classe:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">Post</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">User</span><span class="p">)</span>
    <span class="n">date_created</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">now</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
    <span class="n">slug</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">SlugField</span><span class="p">()</span>
</code></pre></div>
</td></tr></table>

<p>Este model tem um usuário associado, a data de publicação do post, o próprio texto e um campo chamado <strong><em>slug</em></strong>, que identifica um determinado post e vai ser útil pra poder fazer buscas.</p>
<p>Pra personalizar o slug, você precisa sobrescrever o método save() do model. Neste caso, vamos pegar somente os 50 primeiros caracteres do post como slug:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">slug</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slug</span> <span class="o">=</span> <span class="n">slugify</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">)[:</span><span class="mi">50</span><span class="p">]</span>
    <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Entry</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>

<p>A classe completa fica assim:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">tastypie.utils.timezone</span> <span class="kn">import</span> <span class="n">now</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django.utils.text</span> <span class="kn">import</span> <span class="n">slugify</span>


<span class="k">class</span> <span class="nc">Post</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">User</span><span class="p">)</span>
    <span class="n">date_created</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateTimeField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">now</span><span class="p">)</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
    <span class="n">slug</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">SlugField</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">__unicode__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span>

    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">slug</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">slug</span> <span class="o">=</span> <span class="n">slugify</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">)[:</span><span class="mi">50</span><span class="p">]</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">Entry</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>

<h3>Criando Resources</h3>
<p>Tudo certo, mas como eu faço para expor meus dados através da API?</p>
<p>Você precisa criar <strong>resources</strong>.</p>
<p>No Tastypie, resources são os intermediários entre o usuário da sua API e os models de Django.</p>
<p>Crie o arquivo api.py no diretório da aplicação que você gerou anteriormente:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">tastypie.resources</span> <span class="kn">import</span> <span class="n">ModelResource</span>
<span class="kn">from</span> <span class="nn">rest_app.models</span> <span class="kn">import</span> <span class="n">Post</span>

<span class="k">class</span> <span class="nc">PostResource</span><span class="p">(</span><span class="n">ModelResource</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">resource_name</span> <span class="o">=</span> <span class="s1">&#39;post&#39;</span>
        <span class="n">queryset</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</code></pre></div>
</td></tr></table>

<p>Você também tem que criar um resource para a classe de usuário:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">UserResource</span><span class="p">(</span><span class="n">ModelResource</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">queryset</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="n">resource_name</span> <span class="o">=</span> <span class="s1">&#39;user&#39;</span>
</code></pre></div>
</td></tr></table>

<p>E associar um usuário a um post. Logo, é precisoadicionar a seguinte linha na classe PostResource:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="n">user</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">UserResource</span><span class="p">,</span> <span class="s1">&#39;user&#39;</span><span class="p">)</span>
</code></pre></div>
</td></tr></table>

<p>O arquivo api.py completo fica assim:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">tastypie.resources</span> <span class="kn">import</span> <span class="n">ModelResource</span>
<span class="kn">from</span> <span class="nn">webserver.rest_app.models</span> <span class="kn">import</span> <span class="n">Post</span>
<span class="kn">from</span> <span class="nn">tastypie.authorization</span> <span class="kn">import</span> <span class="n">Authorization</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
<span class="kn">from</span> <span class="nn">tastypie</span> <span class="kn">import</span> <span class="n">fields</span>

<span class="k">class</span> <span class="nc">UserResource</span><span class="p">(</span><span class="n">ModelResource</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">queryset</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="n">resource_name</span> <span class="o">=</span> <span class="s1">&#39;user&#39;</span>
        <span class="n">authorization</span> <span class="o">=</span> <span class="n">Authorization</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">PostResource</span><span class="p">(</span><span class="n">ModelResource</span><span class="p">):</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">UserResource</span><span class="p">,</span> <span class="s1">&#39;user&#39;</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">resource_name</span> <span class="o">=</span> <span class="s1">&#39;post&#39;</span>
        <span class="n">queryset</span> <span class="o">=</span> <span class="n">Post</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="n">authorization</span> <span class="o">=</span> <span class="n">Authorization</span><span class="p">()</span>
</code></pre></div>
</td></tr></table>

<p>A linha <strong><em>authorization = Authorization()</em></strong> serve para que você possa criar e modificar elementos na sua API utilizando o cURL, como vai ser mostrado mais a frente.</p>
<h3>Views e URLs</h3>
<p>Agora você precisa exibir os resources de alguma forma para que seus usuário tenham acesso à API. Para isso, é necessário criar urls para acessar os seus dados. Edite o arquivo urls.py do seu projeto para que fique assim:</p>
<table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">django.conf.urls</span> <span class="kn">import</span> <span class="n">patterns</span><span class="p">,</span> <span class="n">include</span><span class="p">,</span> <span class="n">url</span>
<span class="kn">from</span> <span class="nn">webserver.rest_app.api</span> <span class="kn">import</span> <span class="n">PostResource</span>

<span class="n">post_resource</span> <span class="o">=</span> <span class="n">PostResource</span><span class="p">()</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">patterns</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^api/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="n">post_resource</span><span class="o">.</span><span class="n">urls</span><span class="p">)),</span>
<span class="p">)</span>
</code></pre></div>
</td></tr></table>

<p>Você já pode iniciar o <strong><em>runserver</em></strong> e acessar sua API via URLs, por exemplo:</p>
<p><a href="http://127.0.0.1:8000/api/post/?format=json">http://127.0.0.1:8000/api/post/?format=json</a></p>
<p><a href="http://127.0.0.1:8000/api/post/1/?format=json">http://127.0.0.1:8000/api/post/1/?format=json</a></p>
<h3>Acessando a API</h3>
<p>Você pode interagir com a API usando o <a href="http://curl.haxx.se/">cURL</a>. É possível usar uma ferramenta de gerenciamento de banco SQLite, mas você perde a função de criar o slug automaticamente.</p>
<h4>Recuperando os Dados</h4>
<p>Para visualizar os dados, ou seja, obter os dados com o curl, o procedimento é semelhante a acessar um URL via browser:</p>
<div class="highlight"><pre><span></span><code>$ curl http://localhost:8000/api/post/1/?format<span class="o">=</span>json
</code></pre></div>


<h4>Enviando Dados</h4>
<p>Para enviar e criar novos dados, você precisa usar a função POST, como estamos utilizando json, você pode enviar nesse formato da seguinte forma:</p>
<div class="highlight"><pre><span></span><code><span class="err">curl --dump-header - -H &quot;Content-Type: application/json&quot; -X POST --data &#39;{&quot;text&quot;: &quot;Um post bem rápido&quot;, &quot;user&quot;: &quot;/api/user/1/&quot;}&#39; http://localhost:8000/api/post/</span>
</code></pre></div>


<h3>O estado atual do Tastypie</h3>
<p>Recentemente, o criador do Tastypie escreveu <a href="http://toastdriven.com/blog/2014/may/23/state-tastypie/">este artigo</a> comentando sobre o atual status do Tastypie, não só em termos de desenvolvimento como em popularidade.</p>
<p>O Tastypie ainda não possui uma versão 1.0, pois existem alguns pontos que precisam ser melhorados. Um deles é o desempenho quando muitos objetos precisam ser serializados.</p>
<p>Outra questão importante é a incompatibilidade com o Django 1.7 e ele ainda comenta que possui um novo projeto para framework RESTFul, o <a href="https://github.com/toastdriven/restless">Restless</a>.</p>
<p>Minha intenção com este artigo é apenas mostrar como é simples criar uma API com Python e Django usando o Tastypie, mas existem outras opções que podem ser exploradas e você pode deixar seu comentário se já teve experiência com alguma delas.</p>
        </div>
    </span>

</article>


    </div>

<footer class="PageFooter pure-u-1">
    <div class="u-box">
        <p>O conteúdo deste blog está sob a licença
          <a
              class="PageFooter-link"
              href=""
              title=""
              rel="nofollow"></a>.</p>

        <p>O código está disponível em
          <a
              class="PageFooter-link"
              href=""
              title="Contribute!"
              rel="nofollow"></a>.</p>
    </div>
</footer>  </div>

    <script>
        (function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=
        function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;
        e=o.createElement(i);r=o.getElementsByTagName(i)[0];
        e.src='//www.google-analytics.com/analytics.js';
        r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));
        ga('create','UA-25538784-1');ga('send','pageview');
    </script>
</body>
</html>