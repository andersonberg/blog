{"version":3,"file":"prism.esm.js","sources":["../src/index.tsx"],"sourcesContent":["/** @jsx jsx */\n/* eslint react/jsx-key: 0 */\nimport { ComponentProps } from 'react'\nimport Highlight, { defaultProps, Language } from 'prism-react-renderer'\nimport { jsx, Styled } from 'theme-ui'\n\nconst aliases: Record<string, Language | undefined> = {\n  js: 'javascript',\n  sh: 'bash',\n}\n\nconst isInRange = (start: number, end: number, num: number) => {\n  if (num >= start && num <= end) {\n    return true\n  }\n  return false\n}\n\nconst checkRanges = (range: number[], num: number) => {\n  for (let i = 0; i < range.length; i += 2) {\n    if (isInRange(range[i], range[i + 1], num)) {\n      return true\n    }\n  }\n  return false\n}\n\ntype HighlightProps = ComponentProps<typeof Highlight>\n// prism-react-renderer doesn't export `Token` type\ntype Tokens = Parameters<HighlightProps['children']>[0]['tokens']\ntype Token = Tokens[number][number]\n\nexport interface ThemeUIPrismProps\n  extends Omit<\n    HighlightProps,\n    'children' | 'code' | 'language' | 'theme' | 'Prism'\n  > {\n  className: string\n  children: string\n  Prism?: HighlightProps['Prism']\n}\nexport default function ThemeUIPrism({\n  children,\n  className: outerClassName,\n  ...props\n}: ThemeUIPrismProps) {\n  const [language] = outerClassName.replace(/language-/, '').split(' ')\n  const lang = aliases[language] || language\n  let startEndRangesToHighlight: number[] = []\n\n  const findStartAndEndHighlights = (tokens: Token[][]) => {\n    const tokensWithoutHighlightComments = tokens.filter((item, index) => {\n      const removeLine = item\n        .map(({ content }) => {\n          if (content === '// highlight-start') {\n            startEndRangesToHighlight.push(index) // track our highlighted lines\n            return true\n          }\n          if (content === '// highlight-end') {\n            startEndRangesToHighlight.push(index - 2) // since we're removing start and end lines, we'll shorten the range by 2 lines\n            return true\n          }\n        })\n        .filter(Boolean)[0]\n\n      if (!removeLine) {\n        return item\n      }\n    })\n    return tokensWithoutHighlightComments\n  }\n\n  const isStartEndHighlighted = (index: number) => {\n    return checkRanges(startEndRangesToHighlight, index)\n  }\n\n  const isInlineHighlighted = (line: Token[]) => {\n    const regex = new RegExp('// highlight-line$')\n    for (let token of line) {\n      if (regex.test(token.content)) {\n        token.content = token.content.replace(regex, '') // remove the highlight-line comment now that we've acted on it\n        return true\n      }\n    }\n    return false\n  }\n\n  const shouldHighlightLine = (line: Token[], index: number) => {\n    return isStartEndHighlighted(index) || isInlineHighlighted(line)\n  }\n\n  return (\n    <Highlight\n      {...defaultProps}\n      {...props}\n      code={children.trim()}\n      language={lang as Language}\n      theme={undefined}>\n      {({ className, style, tokens, getLineProps, getTokenProps }) => {\n        const tokensWithoutHighlightComments = findStartAndEndHighlights(tokens)\n        return (\n          <Styled.pre\n            className={`${outerClassName} ${className}`}\n            style={style}>\n            {tokensWithoutHighlightComments.map((line, i) => {\n              const lineProps = getLineProps({ line, key: i })\n              if (shouldHighlightLine(line, i)) {\n                lineProps.className = `${lineProps.className} highlight`\n              }\n              return (\n                <div {...lineProps}>\n                  {line.map((token, key) => (\n                    <span\n                      {...getTokenProps({ token, key })}\n                      sx={token.empty ? { display: 'inline-block' } : undefined}\n                    />\n                  ))}\n                </div>\n              )\n            })}\n          </Styled.pre>\n        )\n      }}\n    </Highlight>\n  )\n}\n"],"names":["aliases","js","sh","isInRange","start","end","num","checkRanges","range","i","length","ThemeUIPrism","children","outerClassName","className","props","replace","split","language","lang","startEndRangesToHighlight","findStartAndEndHighlights","tokens","tokensWithoutHighlightComments","filter","item","index","removeLine","map","content","push","Boolean","isStartEndHighlighted","isInlineHighlighted","line","regex","RegExp","token","test","shouldHighlightLine","jsx","Highlight","defaultProps","code","trim","theme","undefined","style","getLineProps","getTokenProps","Styled","pre","lineProps","key","sx","empty","display"],"mappings":"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"}