{"version":3,"file":"prism.umd.js","sources":["../src/index.tsx"],"sourcesContent":["/** @jsx jsx */\n/* eslint react/jsx-key: 0 */\nimport { ComponentProps } from 'react'\nimport Highlight, { defaultProps, Language } from 'prism-react-renderer'\nimport { jsx, Styled } from 'theme-ui'\n\nconst aliases: Record<string, Language | undefined> = {\n  js: 'javascript',\n  sh: 'bash',\n}\n\nconst isInRange = (start: number, end: number, num: number) => {\n  if (num >= start && num <= end) {\n    return true\n  }\n  return false\n}\n\nconst checkRanges = (range: number[], num: number) => {\n  for (let i = 0; i < range.length; i += 2) {\n    if (isInRange(range[i], range[i + 1], num)) {\n      return true\n    }\n  }\n  return false\n}\n\ntype HighlightProps = ComponentProps<typeof Highlight>\n// prism-react-renderer doesn't export `Token` type\ntype Tokens = Parameters<HighlightProps['children']>[0]['tokens']\ntype Token = Tokens[number][number]\n\nexport interface ThemeUIPrismProps\n  extends Omit<\n    HighlightProps,\n    'children' | 'code' | 'language' | 'theme' | 'Prism'\n  > {\n  className: string\n  children: string\n  Prism?: HighlightProps['Prism']\n}\nexport default function ThemeUIPrism({\n  children,\n  className: outerClassName,\n  ...props\n}: ThemeUIPrismProps) {\n  const [language] = outerClassName.replace(/language-/, '').split(' ')\n  const lang = aliases[language] || language\n  let startEndRangesToHighlight: number[] = []\n\n  const findStartAndEndHighlights = (tokens: Token[][]) => {\n    const tokensWithoutHighlightComments = tokens.filter((item, index) => {\n      const removeLine = item\n        .map(({ content }) => {\n          if (content === '// highlight-start') {\n            startEndRangesToHighlight.push(index) // track our highlighted lines\n            return true\n          }\n          if (content === '// highlight-end') {\n            startEndRangesToHighlight.push(index - 2) // since we're removing start and end lines, we'll shorten the range by 2 lines\n            return true\n          }\n        })\n        .filter(Boolean)[0]\n\n      if (!removeLine) {\n        return item\n      }\n    })\n    return tokensWithoutHighlightComments\n  }\n\n  const isStartEndHighlighted = (index: number) => {\n    return checkRanges(startEndRangesToHighlight, index)\n  }\n\n  const isInlineHighlighted = (line: Token[]) => {\n    const regex = new RegExp('// highlight-line$')\n    for (let token of line) {\n      if (regex.test(token.content)) {\n        token.content = token.content.replace(regex, '') // remove the highlight-line comment now that we've acted on it\n        return true\n      }\n    }\n    return false\n  }\n\n  const shouldHighlightLine = (line: Token[], index: number) => {\n    return isStartEndHighlighted(index) || isInlineHighlighted(line)\n  }\n\n  return (\n    <Highlight\n      {...defaultProps}\n      {...props}\n      code={children.trim()}\n      language={lang as Language}\n      theme={undefined}>\n      {({ className, style, tokens, getLineProps, getTokenProps }) => {\n        const tokensWithoutHighlightComments = findStartAndEndHighlights(tokens)\n        return (\n          <Styled.pre\n            className={`${outerClassName} ${className}`}\n            style={style}>\n            {tokensWithoutHighlightComments.map((line, i) => {\n              const lineProps = getLineProps({ line, key: i })\n              if (shouldHighlightLine(line, i)) {\n                lineProps.className = `${lineProps.className} highlight`\n              }\n              return (\n                <div {...lineProps}>\n                  {line.map((token, key) => (\n                    <span\n                      {...getTokenProps({ token, key })}\n                      sx={token.empty ? { display: 'inline-block' } : undefined}\n                    />\n                  ))}\n                </div>\n              )\n            })}\n          </Styled.pre>\n        )\n      }}\n    </Highlight>\n  )\n}\n"],"names":["aliases","js","sh","isInRange","start","end","num","checkRanges","range","i","length","ThemeUIPrism","children","outerClassName","className","props","replace","split","language","lang","startEndRangesToHighlight","findStartAndEndHighlights","tokens","tokensWithoutHighlightComments","filter","item","index","removeLine","map","content","push","Boolean","isStartEndHighlighted","isInlineHighlighted","line","regex","RegExp","token","test","shouldHighlightLine","jsx","Highlight","defaultProps","code","trim","theme","undefined","style","getLineProps","getTokenProps","Styled","pre","lineProps","key","sx","empty","display"],"mappings":"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"}